# Алгоритм причинно-согласованного порядка

Воостанавливаем [[Casually consistent order]]

## Централизованный порядок

* Выберем координатора, через которого будем раздавать всем сообщения
* Общение с координатором - с [[FIFO  сообщения|FIFO порядком]] (мы [[Алгоритм восстановления FIFO|умеем]])

## Распределённый порядок
* Используем матричные часы
	* $M_{\large ij}$ = количество сообщений, посланных от $P_{\large i}$ к $P_{\large j}$
		* каждый процесс хранит свою матрицу
	* Перед посылкой сообщения $M_{\large ij} = M_{\large ij} + 1$
* Условие обработки сообщения (должны быть верны все)
	* Если процесс $P_i$ получил сообщение от $P_j$ с матрицей $W$
	* Выполнено [[FIFO  сообщения|FIFO]]: $W_{\large ji} == M_{\large ji} + 1$
	* Casual: $\forall k \neq j: M_{\large ki} \geq W_{\large ki}$
		* Интуиция: а не знает ли пославший про какие-то сообщения, которых я не видел?
	* После обработки: $M = \max(M, W)$


![[Pasted image 20220221174230.png]]