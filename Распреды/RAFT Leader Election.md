# RAFT Leader Election

### Термы
Аналог поколений в [[Paxos]]. Просто последовательные числа

* Начинается с выбора лидера
* Нумеруется последовательными целыми числами
* Каждый сервер помнит наибольший номер
* Не более одного лидера в каждом

![[Pasted image 20220404233407.png]]

### Состояния

[[DFA|Автомат]] состояний
![[Pasted image 20220404233431.png]]

* **Leader**
	* Обрабатывает все запросы
* **Follower** 
	* Все остальные сервера
	* Следит за heartbeats от лидера
* **Candidate**
	* Только на время выборов
	* Ждёт:
		* Консенсуса голосов за себя
			* Большинство (или другой [[Кворум]])
		* Выбора другого лидера
		* Таймаут
	* Когда приходит в это состояние, повышает терм, не слушает сообщения старого терма (в рамках *Leader Election*)

#### Примечания
* таймауты нужны для проверки "живости" лидера
* таймауты рандомизируются
	* за счёт этого разное время превращения в кандидатов, так быстрее
* большинство голосов гарантирует, что выберется один **Leader**
* **Leader** работает пока живой (отвечает по таймауту), пока не узнает, что появился новый

### Election restriction
* Когда кто-то предлагает себя кандидатом, не голосуем, если в нашем журнале есть более свежая запись
	* Или с большим термом
	* Или с большим индексом
	* Сравниваем в таком порядке