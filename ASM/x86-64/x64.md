 # x64

Появилось, чтобы удобнее использовать 64-битное адресное пространство

Вышло из-под пера AMD, начальное название - amd64

Нам дали больше [[x64 Регистры|регистров]]!

А ещё у нас новые [[ASM/x86-64/Конвенции вызова]]

Исполняется на процессоре в специальном [[Режимы работы|режиме]], не совместимым с [[x86]]. Вообще, между ними можно переключаться в юзерспейсе с большого разрешения ОСи

Вызвано тем, что нам вырезали некоторые 32-бит команды, чтобы освободить опкоды
* нам отрезали команды двоично-десятичной арифметики
* `bound` - "бросает", если индекс вне пределов массива
* `into` - "бросает", если произошло переполнение при арифметике
* `pusha`, `popa` - покойтесь с миром
* команды работы с сегментами
* короткие формы `inc`, `dec` - делавшие операции с регистрами (они есть, но длиннее)
* `sysenter`, `sysexit` выпилили, сделали `sycall`, `sysret`
	* `sysenter` - jump в ядро, куда настроит система
	* `sysexit` - jump куда-то в юзерспейс код после вызова системной функции

Для винды все процессы 64-хбитные, есть специальный nt.dll, живущий в юзерспейсе, используется как обвязка для вызова 64-битных системных функций из 32-битного кода

Почти не осталось констант

Можно в:
* `mov r*, const`
* `mov [const addr64], acc`
	* acc: `al` | `ax` | `eax` | `rax`

Что можно в адресе:

`[((rax...r15) + (rax..r15 & [^rsp]) * (1|2|4|8)) | (rip) + const32]`

При этом константа знаковая

Через `rip + const32` можно доступаться к глобальным переменным (иначе через ту байду с аккумулятором). Чтобы включить, добавить `default rel` в асм файлик

