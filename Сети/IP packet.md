# IP пакет
![[Pasted image 20220406151957.png]]

* Version: 4 бита
	* 4 и 6 соответственно
* IHL (IP Header Length): 4 бита - количество 32-битных слов в заголовке
* Next Header - что идёт после заголовка, может лежать:
	* TCP - дальше TCP данные
	* UDP - дальше UDP данные
	* IP extension - ещё данные хедера
		* Если там какой-то заголовок, там тоже будет Next Header
	* Total Length: 16 бит - длина, включая заголовок
		* Не больше 768-и байт
	* Payload Length: 16 бит - длина всего, что после заголовка
		* Существует расширение jumbograms (в Интернете не ходят) - там записана настоящая длина пакета, Payload Length тогда игнорится
		* #NB как правило, сетью не поддерживаются пакеты больше, чем 1.5КБ (1506 октетов)
* MTU - максимальная длина пакета, которую можно передать (те самые 768 / 1506 октетов)
* Иногда пакеты IPv4 пилятся по дороге
	* Identification - проставляется рандомно при распиле, одинаковый у всех пакетов
	* Fragment Offset - оффсет внутри большого распиленного пакета
	* Flags
		* MF (More fragments) - выставляется в _1_, если это не последний пакет из попиленных
		* DF (Don't fragment) - не пилить на фрагменты, а выбрасывать, желательно говорить, какой пакет пролезет
	* #NB в IPv6 1280 байт обязаны пролезть
* Time to Live (TTL) - через сколько прыжков между узлами умрёт пакет
	* Трассировка работает через него: когда где-то пакет умер от TTL, обратно (как правило) отсылается служебное сообщение. Так, постепенно увеличивая TTL, можно последовательно получать сообщения от каждого узла и выяснить путь пакета
* Hop Limit - то же, что TTL
* Header Checksum - CRC32 хеш от всего хедера, кроме TTL
* Type of Service - какое-то представление внутри сети о том, насколько важен пакет, в том числе включает:
	* ECE (Explicit Congestion Enabled) - этот и следующий помогают в [[Congestion control]]
	* ECN (Explicit Congestion Network) - проставляется, если где-то на пути (почти ?) произошёл затык, если проставлен ECE
		* Но узнает об этом клиент
			* Проставит ECE (Explicit Congestion Echo) в [[TCP]] пакете
		* Сервер в (каком-то) следующем пакете проставит CWR (Congestion Window Reduced)
			* После этого клиент перестанет проставлять ECE
* Traffic class - примерно то же, что Type of Service